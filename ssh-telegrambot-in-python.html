<!DOCTYPE html><html lang="en-gb"><head><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width,initial-scale=1,user-scalable=no"><title>SSH TelegramBot in Python - Cibersec and hacking blog</title><meta name="description" content="Today I bring you a project that I finished some time ago, but that has earned a place in my favourite projects: a bot for Telegram. Ok,&hellip;"><meta name="generator" content="Publii Open-Source CMS for Static Site"><script type="gdpr-blocker/">(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
						new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
						j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
						'https://www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
					})(window,document,'script','dataLayer','G-2WG99B8B6N');</script><link rel="canonical" href="https://b4shnhawx.github.io/ssh-telegrambot-in-python.html"><link rel="alternate" type="application/atom+xml" href="https://b4shnhawx.github.io/feed.xml"><link rel="alternate" type="application/json" href="https://b4shnhawx.github.io/feed.json"><meta property="og:title" content="SSH TelegramBot in Python"><meta property="og:image" content="https://b4shnhawx.github.io/media/posts/6/command.jpg"><meta property="og:image:width" content="591"><meta property="og:image:height" content="1280"><meta property="og:site_name" content="Cibersec and hacking blog"><meta property="og:description" content="Today I bring you a project that I finished some time ago, but that has earned a place in my favourite projects: a bot for Telegram. Ok,&hellip;"><meta property="og:url" content="https://b4shnhawx.github.io/ssh-telegrambot-in-python.html"><meta property="og:type" content="article"><link rel="shortcut icon" href="https://b4shnhawx.github.io/media/website/logo_looka_redonded.png" type="image/x-icon"><link rel="stylesheet" href="https://b4shnhawx.github.io/assets/css/fontawesome-all.min.css?v=85514f933f9e0b82460af63f1a403fa5"><link rel="stylesheet" href="https://b4shnhawx.github.io/assets/css/style.css?v=6aab084654595bb5dc362ac645911345"><script type="application/ld+json">{"@context":"http://schema.org","@type":"Article","mainEntityOfPage":{"@type":"WebPage","@id":"https://b4shnhawx.github.io/ssh-telegrambot-in-python.html"},"headline":"SSH TelegramBot in Python","datePublished":"2024-08-21T00:34","dateModified":"2024-08-21T16:02","image":{"@type":"ImageObject","url":"https://b4shnhawx.github.io/media/posts/6/command.jpg","height":1280,"width":591},"description":"Today I bring you a project that I finished some time ago, but that has earned a place in my favourite projects: a bot for Telegram. Ok,&hellip;","author":{"@type":"Person","name":"b4shnhawx","url":"https://b4shnhawx.github.io/authors/b4shnhawx/"},"publisher":{"@type":"Organization","name":"b4shnhawx"}}</script><noscript><style>img[loading] {
                    opacity: 1;
                }</style></noscript></head><body class="is-preload post-template"><script>document.addEventListener("DOMContentLoaded", function() {
    // Selecciona el contenedor donde quieres insertar el HTML
    var sidebarInner = document.querySelector('#sidebar .inner');

    // Crea el contenedor principal que contendr√° el logo y el texto
    var mainContainer = document.createElement('div');
    mainContainer.style.position = "absolute";  // Posici√≥n absoluta para que el contenedor se ajuste correctamente
    mainContainer.style.top = "0";  // Alinea el contenedor al borde superior del sidebar
    mainContainer.style.left = "0";  // Alinea el contenedor al borde izquierdo del sidebar
    mainContainer.style.width = "100%";  // Asegura que el contenedor ocupe todo el ancho del sidebar
    mainContainer.style.height = "150px";  // Define la altura del contenedor
    mainContainer.style.zIndex = "2";  // Asegura que el contenedor est√© por encima de otros elementos
    mainContainer.style.overflow = "hidden";  // Evita que el contenido desborde

    // Crea el fondo difuminado
    var backgroundContainer = document.createElement('div');
    backgroundContainer.style.position = "absolute";
    backgroundContainer.style.top = "0";
    backgroundContainer.style.left = "0";
    backgroundContainer.style.width = "100%";
    backgroundContainer.style.height = "100%";
    backgroundContainer.style.backgroundImage = "url('https://github.com/b4shnhawx/b4shnhawx.github.io/raw/main/media/files/header_bg.jpg')";
    backgroundContainer.style.backgroundSize = "cover";  // Asegura que la imagen cubra todo el contenedor
    backgroundContainer.style.backgroundPosition = "center";  // Centra la imagen
    backgroundContainer.style.filter = "blur(2.5px)";  // Aplica un efecto de difuminado m√°s ligero
    backgroundContainer.style.zIndex = "1";  // Coloca el fondo detr√°s del contenido

    // Crea el contenedor para el logo y el texto
    var contentContainer = document.createElement('div');
    contentContainer.style.display = "flex";  // Alinea los elementos horizontalmente
    contentContainer.style.gap = "10px";  // Espacio entre los contenedores
    contentContainer.style.width = "100%";  // Asegura que el contenedor ocupe el 100% del ancho disponible
    contentContainer.style.height = "100%";  // Asegura que el contenedor ocupe el 100% de la altura disponible
    contentContainer.style.zIndex = "2";  // Coloca el contenido por encima del fondo
    contentContainer.style.position = "relative";  // Asegura que el contenido est√© correctamente posicionado

    // Crea el contenedor del logo
    var logoContainer = document.createElement('div');
    logoContainer.style.width = "150px";
    logoContainer.style.height = "150px";
    logoContainer.style.overflow = "hidden";  // Evita desbordamiento
    logoContainer.style.display = "flex";  // Asegura centrado
    logoContainer.style.alignItems = "center";
    logoContainer.style.justifyContent = "center";

    // Crea el elemento de imagen
    var logoImg = document.createElement('img');
    logoImg.src = "https://avatars2.githubusercontent.com/u/45437051?s=460&u=b4c1990041dd9e22c0df3f87c93b820f364c2988&v=4";
    logoImg.alt = "Fazt Logo";
    logoImg.classList.add('logo-sidebar');

    // A√±ade la imagen al contenedor del logo
    logoContainer.appendChild(logoImg);

    // Crea el contenedor del texto
    var textContainer = document.createElement('div');
    textContainer.style.width = "150px";
    textContainer.style.height = "150px";
    textContainer.style.display = "flex";  // Asegura centrado vertical
    textContainer.style.alignItems = "center";
    textContainer.style.justifyContent = "flex-start";  // Alinea el contenido a la izquierda
    textContainer.style.paddingLeft = "10px";  // A√±ade un poco de espacio desde el borde izquierdo

    // Crea el elemento de texto
    var textElement = document.createElement('div');
    textElement.textContent = "#b4shnhawx";
    textElement.style.fontSize = "27px";  // Aumenta el tama√±o del texto
    textElement.style.textAlign = "left";  // Justifica el texto a la izquierda
    textElement.style.color = "#fff";  // Color blanco para que el texto sea visible

    // A√±ade el texto al contenedor del texto
    textContainer.appendChild(textElement);

    // A√±ade el contenedor del logo y el contenedor del texto al contenedor de contenido
    contentContainer.appendChild(logoContainer);
    contentContainer.appendChild(textContainer);

    // A√±ade el fondo difuminado al contenedor principal
    mainContainer.appendChild(backgroundContainer);

    // A√±ade el contenedor del contenido al contenedor principal
    mainContainer.appendChild(contentContainer);

    // Inserta el contenedor principal al inicio del contenedor de la barra lateral
    sidebarInner.insertBefore(mainContainer, sidebarInner.firstChild);

    // Crea un espaciador para evitar que el contenido de la sidebar se superponga
    var spacer = document.createElement('div');
    spacer.style.height = "100px";  // La misma altura que el contenedor principal

    // Inserta el espaciador despu√©s del contenedor principal
    sidebarInner.insertBefore(spacer, mainContainer.nextSibling);
});</script><script>document.addEventListener("DOMContentLoaded", function() {
    // Selecciona el contenedor de la barra lateral y el footer
    var sidebarInner = document.querySelector('#sidebar .inner');
    var footer = document.querySelector('#footer');

    // Selecciona el elemento que deseas mover
    var searchDiv = document.querySelector('#search.alt');

    // Verifica que el elemento exista antes de moverlo
    if (searchDiv) {
        // Crea el encabezado h2 con la clase major
        var searchHeader = document.createElement('header');
        searchHeader.classList.add('major');

        var searchTitle = document.createElement('h2');
        searchTitle.textContent = "Search for any post...";
        searchTitle.style.marginBottom = "15px";  // A√±ade espacio debajo del texto

        // A√±ade el h2 al encabezado
        searchHeader.appendChild(searchTitle);

        // Mueve el elemento de b√∫squeda justo antes del footer
        sidebarInner.insertBefore(searchDiv, footer);

        // Inserta el encabezado justo antes del cuadro de b√∫squeda
        sidebarInner.insertBefore(searchHeader, searchDiv);
    }
});</script><script>document.addEventListener("DOMContentLoaded", function() {
    // Selecciona el primer elemento con la clase "post__tag"
    var firstTagElement = document.querySelector("div.post__tag");

    // Comprueba si el elemento existe
    if (firstTagElement) {
        // Crea un nuevo div con la clase "post__tag"
        var warningBox = document.createElement("div");
        warningBox.className = "post__tag";
        warningBox.style.fontSize = "small"; // Haz el texto m√°s peque√±o

        // A√±ade el contenido del texto con un salto de l√≠nea al principio y al final
        warningBox.innerHTML = "All content published in this post is for educational purposes only and has been tested in controlled and managed environments by me.";

        // Inserta el nuevo div justo despu√©s del primer div.post__tag
        firstTagElement.insertAdjacentElement('afterend', warningBox);
    }
});</script><div id="wrapper"><div id="main"><div class="inner"><header id="header"><a class="logo" href="https://b4shnhawx.github.io/"><strong>Cibersec and hacking blog</strong></a><ul class="icons"><li><a href="https://x.com/_Myrtivheal" class="icon brands fa-x-twitter"><span class="label">Twitter</span></a></li><li><a href="https://www.linkedin.com/in/darribash/" class="icon brands fa-linkedin"><span class="label">LinkedIn</span></a></li><li><a href="https://www.youtube.com/channel/UCxvS-XzNNYFOq45-ScuLrxA" class="icon brands fa-youtube"><span class="label">YouTube</span></a></li></ul></header><article class="post"><header class="main post__header"><time datetime="2024-08-21T00:34" class="post__date">August 21, 2024</time><h1>SSH TelegramBot in Python</h1></header><figure class="image main normal"><img src="https://b4shnhawx.github.io/media/posts/6/command.jpg" srcset="https://b4shnhawx.github.io/media/posts/6/responsive/command-xs.jpg 300w, https://b4shnhawx.github.io/media/posts/6/responsive/command-sm.jpg 480w, https://b4shnhawx.github.io/media/posts/6/responsive/command-md.jpg 768w, https://b4shnhawx.github.io/media/posts/6/responsive/command-lg.jpg 1024w, https://b4shnhawx.github.io/media/posts/6/responsive/command-xl.jpg 1360w, https://b4shnhawx.github.io/media/posts/6/responsive/command-xxl.jpg 1600w" sizes="(max-width: 1600px) 100vw, 1600px" loading="lazy" height="1280" width="591" alt=""></figure><div class="post__inner post__entry"><p>Today I bring you a project that I finished some time ago, but that has earned a place in my favourite projects: a bot for Telegram.<br><br>Ok, but what is the difference between this bot and any other ‚Äòhello_world_telgrambot.py‚Äô bot on the internet? Basically, this one is capable of interpreting commands on the machine that is running it (Linux) üí£<br><br>Before we throw our hands up in the air ‚ÄòOh no, it's open to the internet and anyone can access it! Yes, that's true, and I know it, but that's why I've added a security measure that's as simple as it is reliable.<br><br>Each Telegram user has a unique ID, so let's use it to our advantage.</p><blockquote><p>Raspberry Pi, in every message sent to the Telegram bot, compare the ID of the sender with the ones I have put in your whitelist. If the ID doesn't match, it's NOT me, so don't pay attention to it.¬†</p></blockquote><p><br>Although I have tried to make it plug-and-play, reducing a lot the necessary configuration to be able to replicate it to your liking, I want to mention several things here even though everything is explained in the comments in the code itself and its repository.<br><br></p><div class="tittle__line"><h3>UNDERSTANDING THE SCRIPT</h3><hr class="line"><p>First of all, please note that the following dependencies must be installed:</p><pre class="language-python"><code>pip3 install telebot
pip3 install python-telegram-bot</code></pre><p>I have divided the code into three parts. Mandatory, Optional and Main.</p><ul><li><strong>Mandatory</strong>: As the name indicates, this part of the code is the minimum for the SSH bot to work.<br><br>In this section you only need to change the token of your bot, and the chat IDs you want to allow. You can put as many IDs as you want separated by commas in case you want multiple users to have access to the same machine.<br><pre class="language-python"><code>........

### -----------------------------------------------
### --------- MANDATORY CODE FOR SSH BOT ----------
### -----------------------------------------------

### --- VARIABLES ---

........

token = "xxxxxxxxx:ABCDEFabcdef..."
permit_chat_id = (CHAT_ID_1, CHAT_ID_2, CHAT_ID_3...)

........</code></pre></li><li><strong>Optional</strong>: Here you can add or modify the existing options and functions as you wish. In my case, the options that I have added are <em>ping_pc</em>, <em>public_ip</em>,<em> magic_packet_pc</em>,<em> suspend_pc MINUTOS</em>,<em> logoff_pc</em>,<em> shut_down_pc</em>,<em> cmd bash command</em>.<br><br>In this section is where you should put the variables for your optional functions. In case you don't want any other optional functions, you can delete all the content up to the MAIN section.<br><pre class="language-python"><code>........

### ------------------------------------------------
### -------- OPTIONAL FUNCTIONS FOR THE BOT --------
### ------------------------------------------------

### --- VARIABLES ---

mac_magic_packet = "MAC_ADDRESS"
ip_pc = "IP_ADDRESS"
user = "USER"
password = "PASSWORD"

........</code></pre><p>To add new functions, at the end of the optional functions I have left an example / template (called EXAMPLE COMMAND) to add other commands with arguments.<br><br>Don't forget that if you add new optional functions, you should add them in the MANDATORY section in the /start and /test commands so that they appear as help.<br><br></p></li><li><strong>Main</strong>: It is the part that runs the bot, so it should not be changed.</li></ul><div class="tittle__line"><h3><strong>USE CASE EXAMPLES</strong></h3><hr class="line"><p>¬†</p><p>To enable and disable SSH mode, simply send the command /terminal. At this point, the bot will indicate the status of the terminal and if it is active, anything we send will be interpreted as a command and the output will be sent to us.<br>(Note that it has its limitations, so don't expect to do a ‚Äòman ssh‚Äô to work xD)</p><p>¬†</p><div style="text-align: center;"><img loading="lazy" style="width: 50%; height: auto;" src="https://github.com/b4shnhawx/ssh-telegram-bot/raw/main/images/command.jpg" alt="Command example" data-is-external-image="true"></div><div>¬†</div><div>Also if the script belongs to root you can get the permissions inherited and execute commands with root.<br><br><br>An example of an intrusion attempt would be this:</div><ol><li>A user without permissions (left screenshot) starts the bot and tries to send the /terminal command to enable SSH (yellow). He also sends several commands to validate if he has access to the machine (green and blue), but the bot has not allowed terminal mode to be enabled.</li><li>To the users in the whitelist it sends a message with the information (middle screenshot), warning that a user has started the bot (red).</li><li>When the anonymous user sends the command /terminal (right screenshot), it will send us a message indicating that it has tried to execute a command (yellow), as well as resending us the command attempts (green and blue).</li></ol><div style="text-align: center;"><img loading="lazy" style="width: 100%; height: auto;" src="https://github.com/b4shnhawx/ssh-telegram-bot/raw/main/images/img_intrusion.jpg" alt="Command example" data-is-external-image="true"></div><div>¬†</div><div>¬†</div><div>¬†</div></div></div></div><footer class="post__inner post__footer"><p class="post__last-updated">This article was updated on August 21, 2024</p><div class="post__share"><h3>Share post:</h3><a href="https://twitter.com/intent/tweet?url=https%3A%2F%2Fb4shnhawx.github.io%2Fssh-telegrambot-in-python.html&amp;via=%40_Myrtivheal&amp;text=SSH%20TelegramBot%20in%20Python" class="js-share icon brands fa-x-twitter" rel="nofollow noopener noreferrer"><span class="label">Twitter</span> </a><a href="https://www.linkedin.com/sharing/share-offsite/?url=https%3A%2F%2Fb4shnhawx.github.io%2Fssh-telegrambot-in-python.html" class="js-share icon brands fa-linkedin" rel="nofollow noopener noreferrer"><span class="label">LinkedIn</span> </a><a href="https://api.whatsapp.com/send?text=SSH%20TelegramBot%20in%20Python https%3A%2F%2Fb4shnhawx.github.io%2Fssh-telegrambot-in-python.html" class="js-share icon brands fa-whatsapp" rel="nofollow noopener noreferrer"><span class="label">WhatsApp</span></a></div><div class="post__tag"><ul><li><strong>Tagged in:</strong></li><li><a href="https://b4shnhawx.github.io/tags/networking/">networking</a></li><li><a href="https://b4shnhawx.github.io/tags/programming/">programming</a></li><li><a href="https://b4shnhawx.github.io/tags/python/">python</a></li><li><a href="https://b4shnhawx.github.io/tags/raspberrypi/">raspberrypi</a></li></ul></div></footer></article><div class="comments-area"><div class="post__inner"><div class="comments"><div class="comments-wrapper"><h2>Comments</h2><div id="graphcomment"></div><noscript>Please enable JS to use the comments form.</noscript><script type="text/javascript">var __semio__params = {
							graphcommentId: "",
							behaviour: {
								uid: "6"
							}
						}

						function __semio__onload() {
							__semio__gc_graphlogin(__semio__params)
						}
						
						
			(function() {
				var gc = document.createElement('script'); gc.type = 'text/javascript'; gc.async = true;
				gc.onload = __semio__onload; gc.defer = true; gc.src = 'https://integration.graphcomment.com/gc_graphlogin.js?' + Date.now();
				(document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(gc);
			})();</script><script type="text/javascript"></script></div></div></div></div><div class="banner banner--after-post"><div class="wrapper"><div id="graphcomment"></div><script type="text/javascript">/* - - - CONFIGURATION VARIABLES - - - */

  var __semio__params = {
    graphcommentId: "b4shnhawx-github-io", // make sure the id is yours

    behaviour: {
      // HIGHLY RECOMMENDED
      //  uid: "...", // uniq identifer for the comments thread on your page (ex: your page id)
    },

    // configure your variables here
    "sidePanel": {
      "width": 480,
      "button": {
        "background": "#313841",
        "color": "#e0e0e0",
    	"width": 1000,
        "label": "Leave a comment"
      },
      "visible": false
    }
  }

  /* - - - DON'T EDIT BELOW THIS LINE - - - */

  function __semio__onload() {
    __semio__gc_sidePanel_graphlogin(__semio__params)
  }


  (function() {
    var gc = document.createElement('script'); gc.type = 'text/javascript'; gc.async = true;
    gc.onload = __semio__onload; gc.defer = true; gc.src = 'https://integration.graphcomment.com/gc_sidePanel_graphlogin.js?' + Date.now();
    (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(gc);
  })();</script></div></div></div></div><div id="sidebar"><div class="inner"><div id="search" class="alt"><form action="https://b4shnhawx.github.io/search.html" class="search__form"><input class="search__input" type="search" name="q" placeholder="search..." aria-label="search..." autofocus required> <button type="submit" class="search__button"><span>Submit</span></button></form></div><nav id="menu"><header class="major"><h2>Menu</h2></header><ul><li><a href="https://b4shnhawx.github.io/" target="_self">HOME</a></li><li><a href="https://b4shnhawx.github.io/authors/b4shnhawx/" target="_self">ABOUT ME</a></li><li class="has-submenu"><a href="https://b4shnhawx.github.io/tags/" target="_self" aria-haspopup="true" class="opener">CATEGORIES</a><ul class="submenu level-2" aria-hidden="true"><li><a href="https://b4shnhawx.github.io/tags/offensive/" target="_self">HACKING OFFENSIVE</a></li><li><a href="https://b4shnhawx.github.io/tags/deffensive/" target="_self">HACKING DEFFENSIVE</a></li><li><a href="https://b4shnhawx.github.io/tags/flipperzero/" target="_self">FLIPPER ZERO</a></li><li><a href="https://b4shnhawx.github.io/tags/programming/" target="_self">PROGRAMMING</a></li><li><a href="https://b4shnhawx.github.io/tags/linux/" target="_self">LINUX</a></li><li><a href="https://b4shnhawx.github.io/tags/windows/" target="_self">WINDOWS</a></li><li><a href="https://b4shnhawx.github.io/tags/networking/" target="_self">NETWORKING</a></li><li><a href="https://b4shnhawx.github.io/tags/cheatsheets/" target="_self">CHEATSHEETS</a></li><li><a href="https://b4shnhawx.github.io/tags/personal/" target="_self">PERSONAL</a></li><li><a href="https://b4shnhawx.github.io/tags/raspberrypi/" target="_self">RASPBERRY PI</a></li></ul></li><li><a href="https://b4shnhawx.github.io/tags/" target="_self">PROJECTS</a></li></ul></nav><section><header class="major"><h2>Get in touch</h2></header><p class="align-center">--== My area of expertise ==--</p><p class="align-center">¬†</p><p class="align-center">üõ° Deffensive Cibersecurity üõ°</p><p class="align-center">‚ô¶Ô∏è¬† ¬† ¬† ¬†Incident Response¬† ¬† ¬† ‚ô¶Ô∏è<br>‚ô¶Ô∏è¬† ¬† ¬† ¬† ¬†Threat Hunting¬† ¬† ¬† ¬† ¬†‚ô¶Ô∏è<br>‚ô¶Ô∏è ¬† Python and Powershell ¬† ‚ô¶Ô∏è<br>‚ô¶Ô∏è¬† ¬† ¬† ¬† ¬† Bash and Linux¬† ¬† ¬† ¬† ¬†‚ô¶Ô∏è</p><p>¬†</p><p>Contact me for any issues :D</p><p><a href="mailto:davidarribash@gmail.com">davidarribash[@]gmail[.]com</a></p></section><footer id="footer"><p class="copyright">¬© b4shnhawx 2024 - All rights reserved</p></footer></div></div></div><script src="https://b4shnhawx.github.io/assets/js/jquery.min.js?v=7c14a783dfeb3d238ccd3edd840d82ee"></script><script src="https://b4shnhawx.github.io/assets/js/browser.min.js?v=c07298dd19048a8a69ad97e754dfe8d0"></script><script src="https://b4shnhawx.github.io/assets/js/breakpoints.min.js?v=81a479eb099e3b187613943b085923b8"></script><script src="https://b4shnhawx.github.io/assets/js/util.min.js?v=cbdaf7c20ac2883c77ae23acfbabd47e"></script><script src="https://b4shnhawx.github.io/assets/js/main.min.js?v=08add7f6d435054ad38ec38d7cf8be40"></script><script>var images=document.querySelectorAll("img[loading]");for(var i=0;i<images.length;i++){if(images[i].complete){images[i].classList.add("is-loaded")}else{images[i].addEventListener("load",function(){this.classList.add("is-loaded")},false)}};</script></body></html>